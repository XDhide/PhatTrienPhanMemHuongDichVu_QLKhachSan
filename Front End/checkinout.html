<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check In/Out - Hotel Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: linear-gradient(180deg, #2d5016 0%, #1a3009 100%);
            color: white;
            padding: 20px;
            overflow-y: auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .logo h1 {
            font-size: 24px;
            color: white;
        }

        .logo-subtitle {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            margin-top: 5px;
        }

        .menu {
            margin-top: 30px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            text-decoration: none;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .menu-item.active {
            background: rgba(255,255,255,0.15);
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .top-bar {
            background: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #2d5016;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #2d5016;
            color: white;
        }

        .content-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2d5016;
            color: white;
        }

        .btn-primary:hover {
            background: #1a3009;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-checkin {
            background: #ffc107;
            color: #333;
        }

        .status-checkout {
            background: #28a745;
            color: white;
        }

        .status-staying {
            background: #17a2b8;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #2d5016;
            font-size: 24px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .booking-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .booking-info h3 {
            color: #2d5016;
            margin-bottom: 10px;
        }

        .booking-info p {
            margin: 5px 0;
            color: #666;
        }

        .api-note {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .api-note h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .api-note code {
            background: rgba(0,0,0,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <span>üè®</span>
            <div>
                <h1>HOTEL</h1>
                <div class="logo-subtitle">Qu·∫£n L√Ω Kh√°ch S·∫°n</div>
            </div>
        </div>

        <div class="menu">
          <a href="/management.html" class="menu-item">
                <span>üè†</span>
                <span>Trang ch·ªß</span>
            </a>
            <a href="/rooms.html" class="menu-item">
                <span>üö™</span>
                <span>Danh M·ª•c Ph√≤ng</span>
            </a>
            <a href="/booking.html" class="menu-item ">
                <span>üìÖ</span>
                <span>ƒê·∫∑t ph√≤ng</span>
            </a>
            <a href="/thanhtoan.html" class="menu-item">
                <span>üí≥</span>
                <span>Thanh to√°n</span>
            </a>
            <a href="/checkinout.html" class="menu-item active">
                <span>‚úÖ</span>
                <span>Check In/Out</span>
            </a>
            <a href="/dichvu.html" class="menu-item">
                <span>üõéÔ∏è</span>
                <span>D·ªãch V·ª•</span>
            </a>
            <a href="/hoadon.html" class="menu-item">
                <span>üí∞</span>
                <span>H√≥a ƒê∆°n</span>
            </a>
            <a href="/baocao.html" class="menu-item " >
                <span>üìä</span>
                <span>B√°o C√°o</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="top-bar">
            <h2>Check In / Check Out</h2>
            <div class="user-info">
                <span id="userName">L·ªÖ T√¢n</span>
                <div class="user-avatar">L</div>
            </div>
        </div>

        <!-- API Note -->
        <div class="api-note">
            <h4>üìå API Endpoints (ƒëang d√πng demo data):</h4>
            <p><strong>GET /api-admin/DatPhong</strong> - L·∫•y danh s√°ch ƒë·∫∑t ph√≤ng theo tr·∫°ng th√°i</p>
            <p><strong>POST /api-admin/CheckIn</strong> - Check in (c·∫≠p nh·∫≠t tr·∫°ng th√°i DaDat ‚Üí DaNhan)</p>
            <p><strong>POST /api-admin/CheckOut</strong> - Check out (c·∫≠p nh·∫≠t tr·∫°ng th√°i DaNhan ‚Üí DaTra, t·∫°o h√≥a ƒë∆°n)</p>
            <p><strong>POST /api-admin/ChuyenPhong</strong> - Chuy·ªÉn ph√≤ng</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('checkin')">Ch·ªù Check In</button>
            <button class="tab-btn" onclick="switchTab('staying')">ƒêang ·ªû</button>
            <button class="tab-btn" onclick="switchTab('checkout')">Ch·ªù Check Out</button>
        </div>

        <!-- Content Card -->
        <div class="content-card">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="T√¨m theo t√™n kh√°ch, s·ªë ph√≤ng, m√£ ƒë·∫∑t..." id="searchInput">
                <button class="btn btn-primary" onclick="searchBookings()">üîç T√¨m ki·∫øm</button>
            </div>

            <div id="bookingsList"></div>
        </div>
    </div>

    <!-- Check In Modal -->
    <div id="checkinModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Check In</h2>
                <button class="close-btn" onclick="closeModal('checkinModal')">&times;</button>
            </div>

            <div class="booking-info" id="checkinBookingInfo"></div>

            <form id="checkinForm">
                <div class="form-group">
                    <label>X√°c nh·∫≠n CMND/CCCD *</label>
                    <input type="text" id="checkinCMND" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>S·ªë ng∆∞·ªùi l·ªõn</label>
                        <input type="number" id="checkinAdults" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>S·ªë tr·∫ª em</label>
                        <input type="number" id="checkinChildren" min="0" value="0">
                    </div>
                </div>

                <div class="form-group">
                    <label>ƒê·∫∑t c·ªçc (VNƒê)</label>
                    <input type="number" id="checkinDeposit" min="0" value="0">
                </div>

                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <textarea id="checkinNote" rows="3"></textarea>
                </div>

                <button type="submit" class="btn btn-success" style="width: 100%;">‚úÖ X√°c nh·∫≠n Check In</button>
            </form>
        </div>
    </div>

    <!-- Check Out Modal -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Check Out</h2>
                <button class="close-btn" onclick="closeModal('checkoutModal')">&times;</button>
            </div>

            <div class="booking-info" id="checkoutBookingInfo"></div>

            <form id="checkoutForm">
                <div class="form-group">
                    <label>Ph√≠ ph√≤ng</label>
                    <input type="number" id="checkoutRoomFee" readonly>
                </div>

                <div class="form-group">
                    <label>Ph√≠ d·ªãch v·ª•</label>
                    <input type="number" id="checkoutServiceFee" value="0" readonly>
                </div>

                <div class="form-group">
                    <label>T·ªïng c·ªông</label>
                    <input type="number" id="checkoutTotal" readonly style="font-weight: bold; font-size: 18px;">
                </div>

                <div class="form-group">
                    <label>H√¨nh th·ª©c thanh to√°n *</label>
                    <select id="checkoutPayment" required>
                        <option value="">-- Ch·ªçn --</option>
                        <option value="TienMat">Ti·ªÅn m·∫∑t</option>
                        <option value="The">Th·∫ª</option>
                        <option value="ChuyenKhoan">Chuy·ªÉn kho·∫£n</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>S·ªë ti·ªÅn thanh to√°n *</label>
                    <input type="number" id="checkoutAmount" min="0" required>
                </div>

                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <textarea id="checkoutNote" rows="3"></textarea>
                </div>

                <button type="submit" class="btn btn-danger" style="width: 100%;">üö™ X√°c nh·∫≠n Check Out</button>
            </form>
        </div>
    </div>

    <script>
        // Demo data - thay th·∫ø API calls
        const demoBookings = [
            {
                maDatPhong: 19,
                maDat: 'DP019',
                maKhach: 19,
                tenKhach: 'Nguy·ªÖn Th·ªã H√≤a',
                dienThoai: '0918901234',
                maPhong: 4,
                soPhong: '104',
                maLoaiPhong: 'Deluxe',
                ngayNhan: '2024-09-25T14:00:00',
                ngayTra: '2024-09-27T12:00:00',
                soKhach: 1,
                trangThai: 'DaDat',
                ghiChu: 'Solo traveler'
            },
            {
                maDatPhong: 18,
                maDat: 'DP018',
                maKhach: 18,
                tenKhach: 'Tr·∫ßn Th·∫ø Thi√™n',
                dienThoai: '0917890123',
                maPhong: 33,
                soPhong: '303',
                maLoaiPhong: 'VIP',
                ngayNhan: '2024-09-23T16:00:00',
                ngayTra: '2024-09-25T11:00:00',
                soKhach: 4,
                trangThai: 'DaNhan',
                ghiChu: 'Currently staying'
            }
        ];

        let currentTab = 'checkin';
        let currentBooking = null;

        // Load bookings theo tab
        function loadBookings(status) {
            let filtered = [];
            
            if (status === 'checkin') {
                filtered = demoBookings.filter(b => b.trangThai === 'DaDat');
            } else if (status === 'staying') {
                filtered = demoBookings.filter(b => b.trangThai === 'DaNhan');
            } else if (status === 'checkout') {
                filtered = demoBookings.filter(b => b.trangThai === 'DaNhan');
            }

            displayBookings(filtered);
        }

        function displayBookings(bookings) {
            const container = document.getElementById('bookingsList');
            
            if (bookings.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Kh√¥ng c√≥ ƒë·∫∑t ph√≤ng n√†o</p>';
                return;
            }

            let html = '<table><thead><tr>';
            html += '<th>M√£ ƒë·∫∑t</th>';
            html += '<th>Kh√°ch h√†ng</th>';
            html += '<th>Ph√≤ng</th>';
            html += '<th>Lo·∫°i ph√≤ng</th>';
            html += '<th>Ng√†y nh·∫≠n</th>';
            html += '<th>Ng√†y tr·∫£</th>';
            html += '<th>Tr·∫°ng th√°i</th>';
            html += '<th>Thao t√°c</th>';
            html += '</tr></thead><tbody>';

            bookings.forEach(booking => {
                const statusClass = booking.trangThai === 'DaDat' ? 'status-checkin' : 
                                   booking.trangThai === 'DaNhan' ? 'status-staying' : 'status-checkout';
                const statusText = booking.trangThai === 'DaDat' ? 'Ch·ªù nh·∫≠n' : 
                                  booking.trangThai === 'DaNhan' ? 'ƒêang ·ªü' : 'ƒê√£ tr·∫£';

                html += '<tr>';
                html += `<td>${booking.maDat}</td>`;
                html += `<td>${booking.tenKhach}<br><small>${booking.dienThoai}</small></td>`;
                html += `<td><strong>${booking.soPhong}</strong></td>`;
                html += `<td>${booking.maLoaiPhong}</td>`;
                html += `<td>${formatDateTime(booking.ngayNhan)}</td>`;
                html += `<td>${formatDateTime(booking.ngayTra)}</td>`;
                html += `<td><span class="status-badge ${statusClass}">${statusText}</span></td>`;
                html += '<td>';
                
                if (booking.trangThai === 'DaDat') {
                    html += `<button class="btn btn-success" onclick='openCheckInModal(${JSON.stringify(booking)})'>Check In</button>`;
                } else if (booking.trangThai === 'DaNhan') {
                    html += `<button class="btn btn-danger" onclick='openCheckOutModal(${JSON.stringify(booking)})'>Check Out</button>`;
                    html += ` <button class="btn btn-warning" onclick='changeRoom(${JSON.stringify(booking)})'>Chuy·ªÉn ph√≤ng</button>`;
                }
                
                html += '</td>';
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            loadBookings(tab);
        }

        function searchBookings() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = demoBookings.filter(b => 
                b.maDat.toLowerCase().includes(query) ||
                b.tenKhach.toLowerCase().includes(query) ||
                b.soPhong.toLowerCase().includes(query)
            );
            displayBookings(filtered);
        }

        function openCheckInModal(booking) {
            currentBooking = booking;
            const modal = document.getElementById('checkinModal');
            const info = document.getElementById('checkinBookingInfo');
            
            info.innerHTML = `
                <h3>Th√¥ng tin ƒë·∫∑t ph√≤ng</h3>
                <p><strong>M√£ ƒë·∫∑t:</strong> ${booking.maDat}</p>
                <p><strong>Kh√°ch h√†ng:</strong> ${booking.tenKhach}</p>
                <p><strong>Ph√≤ng:</strong> ${booking.soPhong} - ${booking.maLoaiPhong}</p>
                <p><strong>Th·ªùi gian:</strong> ${formatDateTime(booking.ngayNhan)} ‚Üí ${formatDateTime(booking.ngayTra)}</p>
            `;
            
            modal.classList.add('show');
        }

        function openCheckOutModal(booking) {
            currentBooking = booking;
            const modal = document.getElementById('checkoutModal');
            const info = document.getElementById('checkoutBookingInfo');
            
            // T√≠nh ph√≠ ph√≤ng (gi·∫£ s·ª≠ 800k/ƒë√™m)
            const nights = Math.ceil((new Date(booking.ngayTra) - new Date(booking.ngayNhan)) / (1000 * 60 * 60 * 24));
            const roomFee = nights * 800000;
            const serviceFee = 0;
            const total = roomFee + serviceFee;
            
            info.innerHTML = `
                <h3>Th√¥ng tin ƒë·∫∑t ph√≤ng</h3>
                <p><strong>M√£ ƒë·∫∑t:</strong> ${booking.maDat}</p>
                <p><strong>Kh√°ch h√†ng:</strong> ${booking.tenKhach}</p>
                <p><strong>Ph√≤ng:</strong> ${booking.soPhong} - ${booking.maLoaiPhong}</p>
                <p><strong>S·ªë ƒë√™m:</strong> ${nights} ƒë√™m</p>
            `;
            
            document.getElementById('checkoutRoomFee').value = roomFee;
            document.getElementById('checkoutServiceFee').value = serviceFee;
            document.getElementById('checkoutTotal').value = total;
            document.getElementById('checkoutAmount').value = total;
            
            modal.classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function changeRoom(booking) {
            alert(`Ch·ª©c nƒÉng chuy·ªÉn ph√≤ng cho ${booking.maDat} - S·∫Ω ƒë∆∞·ª£c tri·ªÉn khai`);
        }

        function formatDateTime(dateStr) {
            const d = new Date(dateStr);
            return d.toLocaleDateString('vi-VN') + ' ' + d.toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'});
        }

        // Form submissions
        document.getElementById('checkinForm').addEventListener('submit', (e) => {
            e.preventDefault();
            console.log('Check In:', {
                maDatPhong: currentBooking.maDatPhong,
                cmnd: document.getElementById('checkinCMND').value,
                adults: document.getElementById('checkinAdults').value,
                children: document.getElementById('checkinChildren').value,
                deposit: document.getElementById('checkinDeposit').value,
                note: document.getElementById('checkinNote').value
            });
            
            alert('Check in th√†nh c√¥ng!\n\nAPI: POST /api-admin/CheckIn');
            closeModal('checkinModal');
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i demo
            currentBooking.trangThai = 'DaNhan';
            loadBookings(currentTab);
        });

        document.getElementById('checkoutForm').addEventListener('submit', (e) => {
            e.preventDefault();
            console.log('Check Out:', {
                maDatPhong: currentBooking.maDatPhong,
                roomFee: document.getElementById('checkoutRoomFee').value,
                serviceFee: document.getElementById('checkoutServiceFee').value,
                total: document.getElementById('checkoutTotal').value,
                payment: document.getElementById('checkoutPayment').value,
                amount: document.getElementById('checkoutAmount').value,
                note: document.getElementById('checkoutNote').value
            });
            
            alert('Check out th√†nh c√¥ng!\nH√≥a ƒë∆°n ƒë√£ ƒë∆∞·ª£c t·∫°o.\n\nAPI: POST /api-admin/CheckOut');
            closeModal('checkoutModal');
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i demo
            currentBooking.trangThai = 'DaTra';
            loadBookings(currentTab);
        });

        // Load initial data
        loadBookings('checkin');
    </script>
</body>
</html>