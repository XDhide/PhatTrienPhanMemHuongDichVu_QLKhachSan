<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Hotel Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #667eea;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 25px;
            transition: background 0.3s;
        }

        .user-profile:hover {
            background: #f0f0f0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: -280px;
            top: 70px;
            width: 280px;
            height: calc(100vh - 70px);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s;
            z-index: 999;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .sidebar-menu li:hover {
            background: #f0f0f0;
            border-left-color: #667eea;
        }

        .sidebar-menu li.active {
            background: #f0f0f0;
            border-left-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }

        /* User Panel Slide */
        .user-panel {
            position: fixed;
            right: -350px;
            top: 70px;
            width: 350px;
            height: calc(100vh - 70px);
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s;
            z-index: 999;
            padding: 30px;
        }

        .user-panel.active {
            right: 0;
        }

        .user-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .user-info .avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        .info-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .info-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-weight: 500;
        }

        .logout-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 30px;
            transition: transform 0.3s;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            margin-top: 70px;
            padding: 30px;
            transition: margin-left 0.3s;
        }

        .content-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .content-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        /* Room Grid */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .room-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 5px solid;
            position: relative;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .room-card.available {
            border-left-color: #4caf50;
        }

        .room-card.occupied {
            border-left-color: #f44336;
        }

        .room-card.maintenance {
            border-left-color: #ff9800;
        }

        .room-number {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .room-type {
            color: #666;
            margin-bottom: 5px;
        }

        .room-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
        }

        .room-card.available .room-status {
            background: #e8f5e9;
            color: #4caf50;
        }

        .room-card.occupied .room-status {
            background: #ffebee;
            color: #f44336;
        }

        .room-card.maintenance .room-status {
            background: #fff3e0;
            color: #ff9800;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 18px;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 998;
        }

        .overlay.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
            <div class="logo">
                üè® HOTEL
            </div>
        </div>
        <div class="user-profile" onclick="toggleUserPanel()">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">Loading...</span>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <ul class="sidebar-menu">
            <li class="active" onclick="switchView('rooms')">üìã Qu·∫£n l√Ω ph√≤ng</li>
            <li onclick="switchView('bookings')">üìÖ ƒê·∫∑t ph√≤ng</li>
            <li onclick="switchView('customers')">üë• Kh√°ch h√†ng</li>
            <li onclick="switchView('prices')">üí∞ B·∫£ng gi√°</li>
            <li onclick="switchView('reports')">üìä B√°o c√°o</li>
        </ul>
    </div>

    <!-- User Panel -->
    <div class="user-panel" id="userPanel">
        <div class="user-info">
            <div class="avatar-large" id="avatarLarge">U</div>
            <h2 id="userNameLarge">Loading...</h2>
        </div>
        <div class="info-item">
            <div class="info-label">T√™n ƒëƒÉng nh·∫≠p</div>
            <div class="info-value" id="userUsername">-</div>
        </div>
        <div class="info-item">
            <div class="info-label">Vai tr√≤</div>
            <div class="info-value" id="userRole">-</div>
        </div>
        <div class="info-item">
            <div class="info-label">Email</div>
            <div class="info-value" id="userEmail">-</div>
        </div>
        <button class="logout-btn" onclick="logout()">ƒêƒÉng xu·∫•t</button>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header">
            <h1>Qu·∫£n l√Ω ph√≤ng</h1>
            <p>Ch·ªçn ph√≤ng ƒë·ªÉ xem chi ti·∫øt ho·∫∑c ƒë·∫∑t ph√≤ng</p>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">T·ªïng s·ªë ph√≤ng</div>
                <div class="stat-value" id="totalRooms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ph√≤ng tr·ªëng</div>
                <div class="stat-value" id="availableRooms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ph√≤ng ƒë√£ ƒë·∫∑t</div>
                <div class="stat-value" id="occupiedRooms">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">B·∫£o tr√¨</div>
                <div class="stat-value" id="maintenanceRooms">0</div>
            </div>
        </div>

        <!-- Rooms Grid -->
        <div class="loading" id="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        <div class="rooms-grid" id="roomsGrid"></div>
    </div>

    <!-- Booking Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ƒê·∫∑t ph√≤ng</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="bookingForm">
                <input type="hidden" id="selectedRoomId">
                <div class="form-group">
                    <label>Ph√≤ng</label>
                    <input type="text" id="selectedRoomName" readonly>
                </div>
                <div class="form-group">
                    <label>M√£ kh√°ch h√†ng *</label>
                    <input type="number" id="maKhach" required placeholder="Nh·∫≠p m√£ kh√°ch h√†ng">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i ph√≤ng *</label>
                    <select id="maLoaiPhong" required></select>
                </div>
                <div class="form-group">
                    <label>Ng√†y nh·∫≠n *</label>
                    <input type="datetime-local" id="ngayNhan" required>
                </div>
                <div class="form-group">
                    <label>Ng√†y tr·∫£ *</label>
                    <input type="datetime-local" id="ngayTra" required>
                </div>
                <div class="form-group">
                    <label>S·ªë kh√°ch *</label>
                    <input type="number" id="soKhach" required min="1" value="1">
                </div>
                <div class="form-group">
                    <label>Ghi ch√∫</label>
                    <textarea id="ghiChu" rows="3" placeholder="Ghi ch√∫ th√™m..."></textarea>
                </div>
                <button type="submit" class="btn-submit">ƒê·∫∑t ph√≤ng</button>
            </form>
        </div>
    </div>

    <script>
        // API URLs
        const API_BASE = 'https://localhost:7105';
        const API_ROOMS = `${API_BASE}/api-customer/Phong`;
        const API_ROOM_TYPES = `${API_BASE}/api-customer/LoaiPhong`;
        const API_BOOKINGS = `${API_BASE}/api-customer/DatPhong`;

        let token = localStorage.getItem('token');
        let currentUser = null;
        let rooms = [];
        let roomTypes = [];

        // Check authentication
        if (!token) {
            window.location.href = 'Test/index.html';
        }

        // Parse token and get user info
        function parseToken() {
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                currentUser = {
                    username: payload.sub || payload.unique_name,
                    role: payload.role || payload["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],
                    email: payload.email || 'N/A'
                };
                updateUserUI();
            } catch (error) {
                console.error('Token parse error:', error);
                logout();
            }
        }

        // Update user UI
        function updateUserUI() {
            const initial = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = initial;
            document.getElementById('avatarLarge').textContent = initial;
            document.getElementById('userName').textContent = currentUser.username;
            document.getElementById('userNameLarge').textContent = currentUser.username;
            document.getElementById('userUsername').textContent = currentUser.username;
            document.getElementById('userRole').textContent = currentUser.role;
            document.getElementById('userEmail').textContent = currentUser.email;
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // Toggle user panel
        function toggleUserPanel() {
            const panel = document.getElementById('userPanel');
            const overlay = document.getElementById('overlay');
            panel.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        // Close all panels
        function closeAll() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('userPanel').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        // Logout
        function logout() {
            localStorage.removeItem('token');
            window.location.href = 'Test/index.html';
        }

        // Switch view
        function switchView(view) {
            alert(`Ch·ª©c nƒÉng "${view}" ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn!`);
            closeAll();
        }

        // Fetch rooms
        async function fetchRooms() {
            try {
                const response = await fetch(API_ROOMS, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                if (data.success) {
                    rooms = data.data;
                    displayRooms();
                    updateStats();
                }
            } catch (error) {
                console.error('Error fetching rooms:', error);
                document.getElementById('loading').textContent = 'L·ªói khi t·∫£i d·ªØ li·ªáu ph√≤ng!';
            }
        }

        // Fetch room types
        async function fetchRoomTypes() {
            try {
                const response = await fetch(API_ROOM_TYPES, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                if (data.success) {
                    roomTypes = data.data;
                    populateRoomTypes();
                }
            } catch (error) {
                console.error('Error fetching room types:', error);
            }
        }

        // Populate room types dropdown
        function populateRoomTypes() {
            const select = document.getElementById('maLoaiPhong');
            select.innerHTML = '<option value="">Ch·ªçn lo·∫°i ph√≤ng</option>';
            roomTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type.MaLoaiPhong;
                option.textContent = `${type.Ten} (${type.Ma})`;
                select.appendChild(option);
            });
        }

        // Display rooms
        function displayRooms() {
            const grid = document.getElementById('roomsGrid');
            const loading = document.getElementById('loading');
            
            loading.style.display = 'none';
            grid.innerHTML = '';

            rooms.forEach(room => {
                const card = document.createElement('div');
                const status = getRoomStatus(room.TrangThai);
                card.className = `room-card ${status.class}`;
                card.innerHTML = `
                    <div class="room-number">${room.TenPhong}</div>
                    <div class="room-type">T·∫ßng ${room.Tang}</div>
                    <div class="room-type">Lo·∫°i: ${room.MaLoai}</div>
                    <div class="room-status">${status.text}</div>
                `;
                card.onclick = () => openBookingModal(room);
                grid.appendChild(card);
            });
        }

        // Get room status
        function getRoomStatus(trangThai) {
            const status = String(trangThai).toLowerCase();
            if (status.includes('tr·ªëng') || status === 'available') {
                return { class: 'available', text: 'Tr·ªëng' };
            } else if (status.includes('ƒë√£ ƒë·∫∑t') || status.includes('ƒëang s·ª≠ d·ª•ng') || status === 'occupied') {
                return { class: 'occupied', text: 'ƒê√£ ƒë·∫∑t' };
            } else {
                return { class: 'maintenance', text: 'B·∫£o tr√¨' };
            }
        }

        // Update stats
        function updateStats() {
            const total = rooms.length;
            const available = rooms.filter(r => getRoomStatus(r.TrangThai).class === 'available').length;
            const occupied = rooms.filter(r => getRoomStatus(r.TrangThai).class === 'occupied').length;
            const maintenance = rooms.filter(r => getRoomStatus(r.TrangThai).class === 'maintenance').length;

            document.getElementById('totalRooms').textContent = total;
            document.getElementById('availableRooms').textContent = available;
            document.getElementById('occupiedRooms').textContent = occupied;
            document.getElementById('maintenanceRooms').textContent = maintenance;
        }

        // Open booking modal
        function openBookingModal(room) {
            if (getRoomStatus(room.TrangThai).class !== 'available') {
                alert('Ph√≤ng n√†y kh√¥ng th·ªÉ ƒë·∫∑t!');
                return;
            }
            document.getElementById('selectedRoomId').value = room.MaPhong;
            document.getElementById('selectedRoomName').value = room.TenPhong;
            document.getElementById('maLoaiPhong').value = room.MaLoai;
            document.getElementById('bookingModal').classList.add('active');
        }

        // Close modal
        function closeModal() {
            document.getElementById('bookingModal').classList.remove('active');
            document.getElementById('bookingForm').reset();
        }

        // Submit booking
        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const booking = {
                MaKhach: parseInt(document.getElementById('maKhach').value),
                MaPhong: parseInt(document.getElementById('selectedRoomId').value),
                MaLoaiPhong: parseInt(document.getElementById('maLoaiPhong').value),
                NgayNhan: document.getElementById('ngayNhan').value,
                NgayTra: document.getElementById('ngayTra').value,
                SoKhach: parseInt(document.getElementById('soKhach').value),
                GhiChu: document.getElementById('ghiChu').value,
                TrangThai: 'ChoXacNhan'
            };

            try {
                const response = await fetch(API_BOOKINGS, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(booking)
                });

                const data = await response.json();
                
                if (data.success) {
                    alert('ƒê·∫∑t ph√≤ng th√†nh c√¥ng!');
                    closeModal();
                    fetchRooms(); // Reload rooms
                } else {
                    alert('L·ªói: ' + data.message);
                }
            } catch (error) {
                console.error('Booking error:', error);
                alert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß!');
            }
        });

        // Initialize
        parseToken();
        fetchRooms();
        fetchRoomTypes();
    </script>
</body>
</html>2